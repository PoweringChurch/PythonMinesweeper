<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Fake Market Bot (No Imports)</title>
  <style>
    body { font-family: sans-serif; background:#111; color:#eee; }
    canvas { background:#222; margin:10px 0; border:1px solid #555; }
    button { padding:8px 12px; margin:10px 0; }
  </style>
</head>
<body>
  <h2>Fake Market Trading Bot</h2>
  <button onclick="simulate()">Run Simulation</button>
  <p id="stats"></p>
  <canvas id="priceChart" width="800" height="300"></canvas>
  <canvas id="portfolioChart" width="800" height="300"></canvas>

<script>
function simulate() {
  const steps = 200;
  const startPrice = 100;
  const drift = 0.0005;
  const vol = 0.02;
  const upThreshold = 0.005;
  const downThreshold = 0.005;
  const tradeQty = 10;
  let prices = [startPrice];
  let cash = 10000;
  let position = 0;
  let portfolio = [cash];
  let buys=[], sells=[];

  // generate fake prices
  for (let t=1; t<steps; t++) {
    const ret = drift + vol*(Math.random()*2-1); // random walk
    prices[t] = prices[t-1]*(1+ret);

    const pctChange = (prices[t]-prices[t-1])/prices[t-1];
    if (pctChange>upThreshold) {
      // buy
      cash -= tradeQty*prices[t];
      position += tradeQty;
      buys.push({t,price:prices[t]});
    } else if (pctChange<-downThreshold && position>=tradeQty) {
      // sell
      cash += tradeQty*prices[t];
      position -= tradeQty;
      sells.push({t,price:prices[t]});
    }
    portfolio[t] = cash+position*prices[t];
  }

  document.getElementById("stats").textContent =
    "Final portfolio: $"+portfolio[portfolio.length-1].toFixed(2)+
    " | Trades: "+(buys.length+sells.length);

  drawLineChart("priceChart", prices, buys, sells, "Price");
  drawLineChart("portfolioChart", portfolio, [], [], "Portfolio Value");
}

function drawLineChart(canvasId, data, buys, sells, label) {
  const canvas=document.getElementById(canvasId);
  const ctx=canvas.getContext("2d");
  ctx.clearRect(0,0,canvas.width,canvas.height);

  const w=canvas.width, h=canvas.height;
  const max=Math.max(...data), min=Math.min(...data);
  const scaleY=y=>h-(y-min)/(max-min)*h;

  // axes
  ctx.strokeStyle="#888"; ctx.beginPath();
  ctx.moveTo(40,0); ctx.lineTo(40,h); ctx.lineTo(w,h);
  ctx.stroke();

  // line
  ctx.strokeStyle="#0f0"; ctx.beginPath();
  for(let i=0;i<data.length;i++){
    const x=40+i*(w-40)/data.length;
    const y=scaleY(data[i]);
    if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
  }
  ctx.stroke();

  // buys
  ctx.fillStyle="lime";
  buys.forEach(b=>{
    const x=40+b.t*(w-40)/data.length;
    const y=scaleY(b.price);
    ctx.beginPath(); ctx.arc(x,y,4,0,2*Math.PI); ctx.fill();
  });

  // sells
  ctx.fillStyle="red";
  sells.forEach(s=>{
    const x=40+s.t*(w-40)/data.length;
    const y=scaleY(s.price);
    ctx.beginPath(); ctx.arc(x,y,4,0,2*Math.PI); ctx.fill();
  });

  // label
  ctx.fillStyle="#eee"; ctx.fillText(label,10,15);
}
</script>
</body>
</html>
